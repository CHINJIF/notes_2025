COMP5121
Data Mining and Data Warehousing Applications

Week 9: Advanced Pattern Mining

Dr. Fengmei Jin
ï‚§ Email: fengmei.jin@polyu.edu.hk
ï‚§ Office: PQ747 (+852 3400 3327)
ï‚§ Consultation Hours: 2.30-4.30pm every Thursday

Outline

ï¯ Sequential Association Rules
ï¯ Multi-level Association Rules
ï¯ Multi-dimensional Association Rules
ï¯ Quantitative Association Rules
ï¯ Rare Patterns and Negative Patterns
ï¯ Spatial Association Rules
ï¯ Compressed Patterns

2

MINING SEQUENTIAL ASSOCIATION RULES

3

Examples of Sequential Patterns

ï¯ A customer first buy an iPad, then an Apple Pencil, and then a magic 

keyboard, within a month.

ï¯ If a customer buys a car, he is likely to buy insurance within one week.
ï¯ If the stock price of Apple goes up, it is likely that Samsung, Google, or 

Microsoft up within two days.

ï¯ Other examples

ï® Web access patterns
ï® Weather prediction

4

Basic Concepts: Sequence

ï¯ Each transaction is itemset (a set of items): 
ï¯ Each customerâ€™s multiple transactions:

{Digital Camera, SD Memory card} on 1 Mar
{Digital Video, Tripod} on 10 Mar
{TV, PS5} on 20 Mar

ïƒ  Form a sequence 

ordered by time
ğ‘†ğ‘† =< ğ‘ ğ‘ 1, ğ‘ ğ‘ 2, ğ‘ ğ‘ 3 >

ğ‘ ğ‘  = ğ‘–ğ‘–1, ğ‘–ğ‘–2, â€¦ , ğ‘–ğ‘–ğ‘šğ‘š

ï®
ï®
ï®

ğ‘ ğ‘ 1 =
ğ‘ ğ‘ 2 =
ğ‘ ğ‘ 3 =

ï¯ A sequence consists of a list of transactions in temporal order, 

denoted as 
ï® Sequence length: 
ï® Sequence database: a set of all sequences in the form 

, i.e., the number of transactions.

ğ‘†ğ‘† =< ğ‘ ğ‘ 1, ğ‘ ğ‘ 2, â€¦ , ğ‘ ğ‘ ğ‘›ğ‘› >

ğ‘›ğ‘›

.

< ğ‘†ğ‘†ğ‘†ğ‘†ğ‘†ğ‘†, ğ‘†ğ‘† >

5

Basic Concepts: Sequence Support

ï¯ The support of a sequence 

in a sequence 

is defined as

database 
ï® the fraction of total tuples (NOT individual 
events) that support this sequence in 

ğ‘†ğ‘†

ğ›¼ğ›¼

. 

ï¯ Example:

ï® The support of <a> is 4

ğ‘†ğ‘†

ï¯ S1 contains the item â€˜aâ€™ in three transactions, 
but S1 contributes only one to the support.
ï® The support of <(ab)(c)> is 2 (in S1 and S3)

SID

Sequence

S1

S2

S3

S4

<(a)(abc)(ac)(d)(cf)>

<(ad)(c)(bc)(ae)>

<(ef)(ab)(df)(cb)>

<(e)(g)(af)(c)(bc)>

â€¢ <(a)(bc)(d)(f)> is the 
subsequence of S1
â€¢ <(a)(b)(c)(e)> is NOT 
the subsequence of S2

A sequence 

is a subsequence of 

, denoted as 

, if it exists 

ğ›¼ğ›¼ =< ğ‘ğ‘1, ğ‘ğ‘2, â€¦ , ğ‘ğ‘ğ‘›ğ‘› >

integers 

such that 

ğ›½ğ›½ = < ğ‘ğ‘1, ğ‘ğ‘2, â€¦ , ğ‘ğ‘ğ‘šğ‘š >

.

6

ğ›¼ğ›¼ âŠ† ğ›½ğ›½

ğ‘›ğ‘›

ğ‘—ğ‘—1, ğ‘—ğ‘—2, â€¦ , ğ‘—ğ‘—ğ‘›ğ‘› âˆˆ 1, ğ‘šğ‘š

ğ‘ğ‘1 âŠ† ğ‘ğ‘ğ‘—ğ‘—1, ğ‘ğ‘2 âŠ† ğ‘ğ‘ğ‘—ğ‘—2, â€¦ , ğ‘ğ‘ğ‘›ğ‘› âŠ† ğ‘ğ‘ğ‘—ğ‘—ğ‘›ğ‘›

An Example of Sequence Support

Transaction DB: D

Sequential version of D

Customer ID Transaction Time

Item IDs

Customer ID

Customer Sequence

1

1

2

2

2

3

4

4

4

5

Jun 25

Jun 30

Jun 10

Jun 15

Jun 20

Jun 25

Jun 25

Jun 30

July 25

Jun 12

30

90

10, 20

30

40, 60, 70

30, 50, 70

30

40, 70

90

90

Customer sequence: 
all the transactions 
of a customer is a 
sequence ordered 
by transaction time.

1

2

3

4

5

<(30), (90)>

<(10 20), (30), (40 60 70)>

<(30 50 70)>

<(30), (40 70), (90)>

<(90)>

Given a minimum support = 25%, we can find a 
frequent subsequence:
â€¢ <(30), (90)> with support of 40%: two customers 

(C1 and C4) bought the item 30 in an earlier 
transaction and then item 90 in a later one. 

Sequential Pattern Mining: The mining of frequently 
occurring subsequences as sequential patterns.

7

Sequential Association Rule Mining Steps

1. Sort Phase: Convert 

into a 

of customer sequences

ï®

is sorted with customer-ID as the major key and time as the minor key.

ğ‘†ğ‘†

ğ‘†ğ‘†â€²

2. Frequent Itemset Phase: Find all frequent itemsets 

(using Apriori)

ğ‘†ğ‘†

3. Transformation Phase: Transform each customer sequence into the 

ğ¿ğ¿

frequent itemset representation, i.e., 
where 

4. Sequence Phase: Use Apriori-like algorithms to find all frequent 

ğ‘™ğ‘™ğ‘–ğ‘– âˆˆ ğ¿ğ¿

sequences based on the mined frequent itemsets

< ğ‘ ğ‘ 1, ğ‘ ğ‘ 2, â€¦ , ğ‘ ğ‘ ğ‘›ğ‘› > â†’ < ğ‘™ğ‘™1, ğ‘™ğ‘™2, â€¦ , ğ‘™ğ‘™ğ‘›ğ‘› >

5. Maximal Phase: Find the maximal sequences (the longest sequences 

that cannot be extended) among the set of frequent sequences

8

An Example of Step 1-3

Step 1: Concert to Dâ€™

Step 2: Frequent Itemsets

minsup=25%

Step 3: Transformation

Again, â€œsupportâ€ is defined against 
customer (NOT transaction)!

9

Step 4: AprioriAll Algorithm

{all frequent 1-itemsets}; 

; 

ğ¿ğ¿ğ‘˜ğ‘˜ =
While (
ğ‘˜ğ‘˜ = 2

) {

;

ğ¿ğ¿ğ‘˜ğ‘˜âˆ’1 â‰  âˆ…
New candidates of size 

ğ¹ğ¹ = ğ¹ğ¹ âˆª ğ¿ğ¿ğ‘˜ğ‘˜
For each sequence 
ğ¶ğ¶ğ‘˜ğ‘˜ =

:

ğ‘˜ğ‘˜

/* 

represents the pass number. */ 

ğ‘˜ğ‘˜

generated from 

; 

calculate the count of all candidates in 
ğ‘ ğ‘  âˆˆ ğ‘†ğ‘†â€²

ğ¿ğ¿ğ‘˜ğ‘˜âˆ’1
that are contained in 

;

All candidates in 

with minimum support ;

ğ¶ğ¶ğ‘˜ğ‘˜

ğ‘ ğ‘ 

ğ¶ğ¶ğ‘˜ğ‘˜

ğ¿ğ¿ğ‘˜ğ‘˜ =

;

}

ğ‘˜ğ‘˜ += 1
Return (

);

ğ¹ğ¹

10

An Example of Step 4 (Sequence Phase)

Supp
2
0
1
0

The maximal frequent sequences:
â€¢ <1 2 3 4>
â€¢ <1 3 5>
â€¢ <4 5>

A sequence is maximal if it is NOT 
contained in any other sequence.

11

Candidate Sequence Generation

ï¯ Similar to non-sequential association rule mining, i.e.,

Step 1: self-joining 

insert into 

select 

from 

where 

ğ‘ªğ‘ªğ’Œğ’Œ
, 
as 
ğ’‘ğ’‘. ğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’ŠğŸğŸ
ğ‘³ğ‘³ğ’Œğ’Œâˆ’ğŸğŸ

ğ‘³ğ‘³ğ‘˜ğ‘˜âˆ’1
, 

, â€¦, 

, 

as 

ğ’‘ğ’‘. ğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’ŠğŸğŸ

ğ’‘ğ’‘. ğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Œğ’Œâˆ’ğŸğŸ

ğ’’ğ’’_ğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Œğ’Œâˆ’ğŸğŸ

ğ‘³ğ‘³ğ’Œğ’Œâˆ’ğŸğŸ
ğ’‘ğ’‘
, and 
ğ’‘ğ’‘. ğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’ŠğŸğŸ = ğ’’ğ’’. ğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’ŠğŸğŸ

ğ’’ğ’’

, â€¦, 

ğ’‘ğ’‘. ğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Œğ’Œâˆ’ğŸğŸ = ğ’’ğ’’. ğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Œğ’Œâˆ’ğŸğŸ

ğ’‘ğ’‘. ğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Œğ’Œâˆ’ğŸğŸ < ğ’’ğ’’. ğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Šğ’Œğ’Œâˆ’ğŸğŸ

Step 2: pruning

for all sequence 

in 

do

for all 

-subsequence 
ğ‘ªğ‘ªğ’Œğ’Œ

ğ’„ğ’„

of 

do

if (

is not in 
(ğ‘˜ğ‘˜ âˆ’ 1)

) then delete 
ğ’Šğ’Š

ğ’„ğ’„

from 

ğ’Šğ’Š

ğ‘³ğ‘³ğ’Œğ’Œâˆ’ğŸğŸ

ğ’„ğ’„

ğ‘ªğ‘ªğ’Œğ’Œ

Example: 
L3 = {abc, abd, acd, ace, bcd}

Self-joining: L3*L3
â€¢ abcd and abdc from abc and abd
â€¢ acde and aced from acd and ace

Prunining:
â€¢ abdc is removed as adc/bdc is not in L3
â€¢ acde is removed as ade/cde is not in L3
â€¢ aced is removed as aed/ced is not in L3

C4={abcd}

12

Maximal Sequence

ï¯ Subsequence: A sequence 

is contained in 

another sequence 

if there exists integers 

< ğ‘ğ‘1, ğ‘ğ‘2, â€¦ , ğ‘ğ‘ğ‘›ğ‘› >

such that 
< ğ‘ğ‘1, ğ‘ğ‘2, â€¦ , ğ‘ğ‘ğ‘šğ‘š >

ï® <(3), (4 5), (8)> is contained in <(7), (3 8), (9), (4 5 6), (8)> ?
ğ‘ğ‘1 âŠ† ğ‘ğ‘ğ‘—ğ‘—1, ğ‘ğ‘2 âŠ† ğ‘ğ‘ğ‘—ğ‘—2, â€¦ , ğ‘ğ‘ğ‘›ğ‘› âŠ† ğ‘ğ‘ğ‘—ğ‘—ğ‘›ğ‘›
ğ‘—ğ‘—1 < ğ‘—ğ‘—2 < â‹¯ < ğ‘—ğ‘—ğ‘›ğ‘› â‰¤ ğ‘šğ‘š
ï® <(3), (5)> is contained in <(3 5)> ?

FALSE

1 â‰¤

TRUE

ï¯ Customers bought â€œiPadâ€ in Jan (3), then â€œApple Pencilâ€ in Feb (5)
ï¯ Customers bought â€œiPadâ€ and â€œApple Pencilâ€ together (3 5)

A sequence 

is maximal if 

is not contained 

in any other sequence.

ğ‘ ğ‘ 

ğ‘ ğ‘ 

13

Forming the Sequential Association Rules

ï¯ Again, the user specified confidence is used for rule generation 

to qualify the strength of sequential association rules.

ï¯ The rule generation step is rather simple:

ï® For each frequent sequence 

, divide the sequence into two nonempty 

sequential parts

and 

and generate the rule 

ğ‘†ğ‘†

ï® If 

satisfies the threshold, 

ğ‘†ğ‘†ğ‘“ğ‘“

ğ‘†ğ‘†ğ‘™ğ‘™

ğ‘…ğ‘…: ğ‘†ğ‘†ğ‘“ğ‘“ â†’ ğ‘†ğ‘†ğ‘™ğ‘™

, 

then 
ğ‘…ğ‘…

is a strong rule and should be output.
ğ‘ğ‘ğ‘ğ‘ğ‘›ğ‘›ğ‘ğ‘ ğ‘†ğ‘†ğ‘“ğ‘“ â†’ ğ‘†ğ‘†ğ‘™ğ‘™ =

ğ‘ ğ‘ ğ‘ ğ‘ ğ‘ ğ‘ ğ‘ ğ‘ ğ‘ ğ‘ ğ‘ ğ‘ ğ‘ ğ‘  ğ‘†ğ‘†
ğ‘ ğ‘ ğ‘ ğ‘ ğ‘ ğ‘ ğ‘ ğ‘ ğ‘ ğ‘ ğ‘ ğ‘ ğ‘ ğ‘  ğ‘†ğ‘†ğ‘“ğ‘“ â‰¥ ğ‘šğ‘šğ‘–ğ‘–ğ‘›ğ‘› _ğ‘ğ‘ğ‘ğ‘ğ‘›ğ‘›ğ‘ğ‘
ï¯ Example: <1 2 3 4> will form 1 ïƒ  2 3 4, 1 2 ïƒ  3 4, 1 2 3 ïƒ  4
ï® Rules like 1 3 ïƒ  2 4, 1 2 4 ïƒ  3 cannot be formed as the 

ğ‘…ğ‘…

temporal order has been distorted!

14

MINING MULTI-LEVEL ASSOCIATION RULES

15

Concept Hierarchy for Electronics

Level 0

Level 1

Level 2

Level 3

TID

T100

T200

T300

T400

T500

Items (Level 2)

Laptop, Printer

Office, Mouse

Mouse, Wrist Pad

Laptop, Digital Camera

Desktop, Antivirus

16

Multiple-Level Association Rules

ï¯ Items often form hierarchy!

ï® Strong rules discovered at high abstraction 
levels â€“ could be commonsense knowledge
ï® Items at the lower level are expected to have 

lower support, or trivial at higher levels
ï® Rules regarding itemsets at appropriate 

levels could be more useful.
ï¯ milk ïƒ  bread
ï¯ milk ïƒ  wheat bread 
ï¯ 2% milk ïƒ  wheat bread 
ï¯ â€¦

17

Mining Multilevel Association Rules â€“ top-down

ï¯ Regarding support, counts are accumulated for the calculation 

of frequent itemsets at each concept level.
ï® Start at Level 1 and work downward in the hierarchy toward more 

specific concept levels, until no more frequent itemsets can be found. 
ï® For each level, any algorithm for discovering frequent itemsets may be 

used, e.g., Apriori or its variations.

ï¯ Choosing the right support threshold:

ï® Uniform support for all levels
ï® Reduced support at lower levels: the deeper, the smaller
ï® â€¦

18

Redundancy Problem

ï¯ A rule is redundant if its support is close to the â€œexpectedâ€ 

value based on the ruleâ€™s ancestors.
ï® R1: milk ïƒ  wheat bread [support = 8%, confidence = 70%]
ï® R2: 2% milk ïƒ  wheat bread [support = 2%, confidence = 72%]
ï® R1 is an ancestor of R2 ïƒ  R2 is redundant!

ï¯ An additional step to handle redundancy :

ï® Add all the ancestors of each item in the original transactions 

to 

, and call it extended transaction 

ğ‘‡ğ‘‡
ï® Run any association rule mining algorithm (e.g. Apriori) on the 

ğ‘‡ğ‘‡

extended transactions

ğ‘»ğ‘»â€²

19

An Example

ï¯ Form the extended transactions

ï¯ Find frequent itemsets

ï¯ Find the rules

minsup = 30%

minconf = 60%

20

multi-dimensional rules, quantitative rules, rare/negative patterns, compressed patterns

OTHER ASSOCIATION RULES

21

Multi-Dimensional Associations

ï¯ Single-dimensional Rules: a single predicate â€œbuysâ€

ï® buys(X, â€œmilkâ€) ïƒ  buys(X, â€œbreadâ€) 

ï¯ Multi-dimensional Rules: 

2 dimensions or predicates

ï® Inter-dimension association rules (no repeated predicates)
ï¯ age(X, â€œ19-25â€) ïƒ  occupation(X, â€œstudentâ€) ïƒ  buys(X, â€œLaptopâ€)
ï® Hybrid-dimension association rules (repeated predicates)

â‰¥

ï¯ age(X, â€œ19-25â€) ïƒ  buys(X, â€œchipsâ€) ïƒ  buys(X, â€œLaptopâ€)

22

Mining Quantitative Associations

ï¯ Techniques can be categorized by how quantitative attributes, 

such as age or salary, are treated:

1. Static discretization based on predefined concept hierarchies

ï¯ Partition salary as â€œ0..20Kâ€, â€œ21..30Kâ€, â€¦ ïƒ  each interval is a category

2. Dynamic discretization based on data distribution

ï¯ To satisfy some mining criteria, such as maximizing the confidence or 

compactness of the rules mined.

3. Clustering: Distance-based association

ï¯ one dimensional clustering, then association
ï¯ e.g., age(X, â€œ30-40â€) 

salary(X, â€œ30..40Kâ€) ïƒ  buys(X, â€œTVâ€)

âˆ§

23

Rare Patterns and Negative Patterns

ï¯ It is interesting to discover and examine exceptional cases:
ï® A rare pattern occurs when an item or combination of items 

appears infrequently in the data (threshold-based, user-specific)
ï¯ In jewelry sales, diamond watches might sell rarely

ï® A negative pattern occurs when two items are individually 

frequent but rarely purchased together, i.e., 

ï¯ In supermarket data, if we find that customers frequently buy diet coke 
sup ğ‘‹ğ‘‹ Ã— sup ğ‘Œğ‘Œ
or classic coke but not both, then buying them together is considered a 
negative (correlated) pattern.

sup ğ‘‹ğ‘‹ âˆª ğ‘Œğ‘Œ <

24

Spatial Association Rules

ï¯ Spatial association rule: 

[s%, c%]

ï®

and 

are sets of spatial or nonspatial predicates

ğ´ğ´ â†’ ğµğµ

ï¯ Topological relations: disjoint, meets, inside, etc.
ğ´ğ´
ï¯ Spatial orientations: left_of, west_of, under, etc.
ï¯ Distance information: close_to, within_distance, etc.

ğµğµ

ï¯ Examples

, urban_district) 

is_a(
ïƒ  adjacent_to(

intersect(

, MTR_line) 
, Victoria_Harbour) [7%, 85%]

ğ‘‹ğ‘‹

âˆ§

ğ‘‹ğ‘‹

ğ‘‹ğ‘‹
, tourist_attraction) 

within(

, Sichuan_province)

is_a(
ïƒ  close_to(
ğ‘‹ğ‘‹

, panda_reserve) [2%, 88%]
âˆ§

ğ‘‹ğ‘‹

ğ‘‹ğ‘‹

25

Contributions of Association Rule Mining

ï¯ Basically, it is more like a statistical technique, i.e., not too much 

intelligence is embedded!

ï¯ But it is easy and flexible to apply, offering efficient DB solutions 

to very large database applications.
ï® Keep track of the supposedly huge number of candidate itemsets

through limited RAM.

ï® Can be applied to virtually all applications and all available data.

ï¯ What is a transaction in your application?
ï¯ What is an item in your application? â€“ a basic unit
ï¯ What is a customer in your application? (for sequential association rules)

26

Mining Stock Data â€“ Intra-stock Mining

â€¢ Customer: Stock, e.g., 
IBM, MSFC, INTC, â€¦

â€¢ Item: Trends (each price 
movement), e.g., Go-up, 
Go-down, â€¦

â€¢ Rules: e.g., â€œgo-up, go-
up, and then go-downâ€

27

Mining Stock Data â€“ Inter-stock Mining

â€¢ Each time window is treated 

as a â€œTransactionâ€

â€¢ To analyze the behavior of 

different stocks within a time 
window

â€¢ open-high-close-low
â€¢ open-low-close-low
â€¢ â€¦

28

Mining the Data of Confirmed SARS Patients

â€¢ Item: # patients

â€¢ Transaction: 
Daily record

â€¢ Customer: each 

region

29

Compressed Patterns

ï¯ Using thresholds to control # rules has limited effect.
ï® Too low ïƒ  an explosive number of output patterns
ï® Too high ïƒ  the discovery of only commonsense patterns

â€¢

â€¢

is a closed frequent itemset in a 

if X is frequent and there 
of 

dataset 
ğ‘‹ğ‘‹
exists no proper super-itemset 
ğ‘†ğ‘†
such that 
count as 

has the same support 
in 

ğ‘Œğ‘Œ

.

ğ‘‹ğ‘‹

ğ‘Œğ‘Œ
ğ‘‹ğ‘‹

is a maximal frequent itemset in 

ğ‘†ğ‘†

if 
data set 
ğ‘‹ğ‘‹
exists no super-itemset 
ğ‘‹ğ‘‹
is frequent.

is frequent and there 
such that 

ğ‘†ğ‘†
and 

ğ‘Œğ‘Œ

ğ‘‹ğ‘‹ âŠ‚ ğ‘Œğ‘Œ

ğ‘Œğ‘Œ

Item Support 

Item Support 

A

B

C

AB

AC

BC

ABC

5

7

10

5

5

7

5

A

B

C

AB

AC

BC

ABC

5

7

10

5

5

7

4

30

Summary: Patterns and Rules

itemsets satisfying minsup

both minsup and minconf

ïƒ  compressed

based on the abstraction 
levels involved in a pattern

1) occur rarely; 2) reveal 
a negative correlation

32

Summary: Methods and Applications

with domain-specific 
semantics

serves as an 
intermediate step
(preprocessing) 

33

Email: fengmei.jin@polyu.edu.hk

Office: PQ747

THANK YOU!

34

